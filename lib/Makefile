ifndef TOPDIR
TOPDIR=..
endif
include $(TOPDIR)/Makefile.global

# Change baseDir in composer autogenerated files
define fix_composer_paths
	for file in autoload_psr4.php autoload_classmap.php autoload_files.php autoload_namespaces.php ; do \
		sed -i "s#^\$$baseDir = .*#\$$baseDir = dirname('$(domserver_webappdir)');#" $(1)/composer/$$file ; \
	done
	sed -i "s#__DIR__ \. '/\.\./\.\./\.\.' \. '/webapp#'$(domserver_webappdir)#" $(1)/composer/autoload_static.php
endef

install-domserver:
	for i in vendor/* ; do \
		$(call install_tree,$(DESTDIR)$(domserver_libvendordir),$$i) ; \
	done
	$(call fix_composer_paths,$(DESTDIR)$(domserver_libvendordir))
